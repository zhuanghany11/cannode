---
alwaysApply: true
---
已有的程序中 shantui.cc和shantui.h是进行参考的范本，不要修改其中的内容。
xugong.cc和xugong.h可以忽略
changan.cc和changan.h是主要进行修改的代码，其他部分的代码也可以根据情况进行修改。

doc/changan_protocol.dbc是长安车辆的dbc文件，也是我们需要使用的参考数据。

项目的目标：将当前程序修改为适配changan_protocol.dbc的控制方式，从而能够进行车辆控制。其中有价值的数据发送部分在为（dbc中消息需要将编号减去0x80000000后使用）：
0x18000001,  # 控制命令消息
0x18000002,  # 液压电机控制消息  
0x18000003,  # 行走电机控制消息
0x18000004,   # 机构电磁阀控制消息

其中，输入的数据保持不变，来自protobuf形式的ROS2消息<sa_msgs::msg::ProtoAdapter>"/vehicle_command"

需要做的工作如下：
1. 将输入的vehicle_command中的车辆速度、大臂角度、铲斗角度、转向角度进行解析。
2. 通过CAN总线读取3个倾角仪和1个转向角度编码器的数据，并将其解析为大臂角度、铲斗角度、车身转向角度数据。（当前可以保留接口，后续具体定义好CAN消息后再使用）
3. 编写4个独立的闭环控制器，根据changan_protol.dbc的消息方式，分别将实现通过车辆加速度闭环控制车速、大臂液压阀开度闭环控制大臂角度、铲斗液压阀开度闭环控制铲斗、转向液压阀开度和方向闭环控制角度。
4. 最后将加速度、大臂液压阀开度、铲斗液压阀开度、转向液压阀开度和方向的数据，按照changan_protocol.dbc的形式发送出去。